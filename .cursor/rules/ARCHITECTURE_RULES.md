# アーキテクチャルール

## レイヤー構造

```
src/
├── application/  # ユースケース層
├── domain/      # ドメインモデル層
├── repo/        # リポジトリインターフェース層
└── infra/       # インフラストラクチャ層
```

## 各レイヤーの役割と制約

### 1. Domain Layer (`src/domain/`)
- **役割**: ビジネスロジックの中核となるドメインモデルとルールを定義
- **制約**:
  - 他のレイヤーに依存してはいけない
  - 外部ライブラリへの依存は最小限に
  - 純粋なビジネスロジックのみを含む
  - インフラストラクチャやフレームワークの詳細を知ってはいけない

### 2. Repository Interface Layer (`src/repo/`)
- **役割**: データアクセスの抽象化インターフェースを定義
- **制約**:
  - Domain Layerのみに依存可能
  - インターフェース定義のみを含む
  - 実装の詳細を含んではいけない
  - 外部サービスとの通信方法を知ってはいけない

### 3. Application Layer (`src/application/`)
- **役割**: ユースケースの実装とアプリケーションのコーディネーション
- **制約**:
  - Domain LayerとRepository Interface Layerに依存可能
  - ビジネスロジックを実装してはいけない
  - ドメインモデルの振る舞いを変更してはいけない
  - インフラストラクチャの詳細を知ってはいけない

### 4. Infrastructure Layer (`src/infra/`)
- **役割**: 外部サービスとの通信や永続化の実装
- **制約**:
  - Repository Interface Layerの実装のみを行う
  - 他のレイヤーのインターフェースを実装してはいけない
  - ドメインロジックを含んではいけない
  - アプリケーションロジックを含んではいけない

## 依存関係のルール

1. 依存の方向は外側から内側のみ許可
   - Infra → Repo → Domain
   - Application → Domain
   - Application → Repo

2. 内側のレイヤーは外側のレイヤーを知ってはいけない
   - Domainは他のレイヤーに依存不可
   - RepoはDomainのみに依存可能
   - ApplicationはDomainとRepoに依存可能
   - InfraはRepoに依存可能

## コードレビューチェックリスト

1. 各ファイルが適切なレイヤーに配置されているか
2. 依存関係が正しい方向を向いているか
3. レイヤーの責務が守られているか
4. ドメインロジックが適切なレイヤーに配置されているか
5. インフラストラクチャの詳細が内側のレイヤーに漏れていないか

## 例外と特別なケース

1. 共通ユーティリティや型定義は適切なレイヤーに配置
2. テストコードは各レイヤーに対応する`__tests__`ディレクトリに配置
3. 設定ファイルは`infra`レイヤーに配置 